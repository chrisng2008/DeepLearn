# 卷积层里的填充和步幅

## 填充
- 给定(32 x 32)输入图像
- 应用 5 x 5大小的卷积核
  - 第1层得到输出大小28 x 28
  - 第7层得到输出大小 4 x 4(在上一层输出的基础上做卷积)
- 更大的卷积核可以更快地减少到输出大小
  - 形状从$n_h \times n_w$减少到$(n_h - n_k + 1)\times (n_w - k_w + 1)$

填充就是为了解决使用更大的卷积核而发生输出快速减小的问题。
填充的原理是，我们在输入的边缘中填充部分的参数。
![图 1](assest/%E5%8D%B7%E7%A7%AF%E5%B1%82%E9%87%8C%E7%9A%84%E5%A1%AB%E5%85%85%E5%92%8C%E6%AD%A5%E5%B9%85/IMG_20220904-222820692.png)  

- 填充$p_h$行和$p_w$列，输出形状为
    $$
        (n_h - k_h + p_h + 1) \times (n_w - k_w + p_w + 1)
    $$
- 通常取$p_h = k_h - 1,\  p_w = k_w - 1$(好处是输入和输出的大小相同)
  - 当$k_h$为奇数：在上下两侧填充$p_h/2$
  - 当$k_h$为偶数：在上侧填充$\left \lceil p_h/2 \right \rceil $, 在下侧填充$\left \lfloor p_h/2 \right \rfloor $

- 填充减小的输出大小和层数线性相关
  - 给定输入大小224 x 224，在使用5 x 5 卷积核的情况下，需要55层将输出降低到4x4((224-4)/4=55)
  - 需要大量的计算才能得到较小输出

## 步幅
- 步幅是指行/列的滑动步长
  - 例如高度3 宽度2 的步幅
- 给定高度$s_h$和宽度$s_w$的步幅，输出形状是
    $$
      \left \lceil (n_h - k_h + p_h + s_h)/s_h \right \rceil \times \left \lceil (n_w - k_w + p_w + s_w)/s_w \right \rceil
    $$
- 如果$p_h=k_h - 1$, $p_w = k_w - 1$
    $$
      \left \lceil (n_h + s_h - 1)/s_h \right \rceil \times \left \lceil (n_w + s_w - 1)/s_w \right \rceil
    $$
- 如果输出高度和宽度可以被步幅整除
  $$
    (n_h / s_h) \times (n_w / s_w)
  $$

### 总结
- 填充和步幅是卷积层的超参数
- 填充在输入周围添加额外的行/列，来控制输出形状的减少量
- 步幅是每次滑动核窗口时的行/列的步长，可以成倍的减少输出形状

