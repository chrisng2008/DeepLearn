# 卷积

- 两个原则
  - 平移不变性
  - 局部性

- 重新考察全连接层
  - 将输入和输出变形为矩阵(宽度，高度)
  - 将权重变形为4-D张量 (h, w) 到 (h', w')
    $$
        h_{i, j} = \sum_{k, l} = w_{i, j, k, l} x_{k, l} = \sum_{a, b} = v_{i, j, a, b} x_{i+a, j+b}
    $$
  - V是W的重新索引$v_{i, j, a, b} = w_{i, j, i+a, j+b}$

## 原则 #1 - 平移不变性
- x的平移导致h的平移$h_{i, j} = \sum_{a, b}v_{i, j, a, b}x_{i+a, j+b}$
    > 简单来说就是输出x的平移会导致输出h的平移
- V不应该依赖与(i, j)
- 解决方案:$v_{i, j, a, b} = v_{a, b}$
    $$
        h_{i, j} = \sum_{a, b} v_{a, b}x_{i+a, j+b}
    $$
    这就是2维卷积(2维交叉相关)

## 原则 #2 - 局部性
$$
    h_{i, j} = \sum_{a, b} v_{a, b}x_{i+a, j+b}
$$

- 当评估$h_{i, j}$时，我们不应该用远离$x_{i, j}$的参数
    > 我们不应该用太过于原理i,j 的点，我们只需要使用i, j 附近的点就行
- 解决方案：当$|a|, |b| > \Delta$时， 使得$v_{a, b} = 0$
    > 意思是， 当a, b的绝对值大于Delta的时候，我们其他的点就不去看了，意味着此时的v_{a, b}=0
    
    $$
        h_{i, j} = \sum_{a=-\Delta}^{\Delta} \sum_{\Delta}^{\Delta} v_{a, b}x_{i+a, j+b}
    $$

## 总结
- 对全连接层使用平移不变性和局部性得到卷积层
    $$
        h_{i, j} = \sum_{a, b} v_{i, j, a, b}x_{i+a, j+b}   \\
        \downarrow  \\
        h_{i, j} = \sum_{a=-\Delta}^{\Delta}\sum_{b=-\Delta}^{\Delta}v_{a, b}x_{i+a, j+b}
    $$
    > 卷积是一种特殊的全连接层